"use strict";(self.webpackChunkmicrofrontend_react_app=self.webpackChunkmicrofrontend_react_app||[]).push([[984],{984:(e,t,o)=>{o.r(t),o.d(t,{default:()=>c,getUploadParameters:()=>s});var n=o(950),a=o(794),l=o(310),i=o(766),r=(o(842),o(182),o(414));const d=async(e,t,o)=>{const n=await fetch(`${window.location.origin}/api/3/action/${t}`,{method:"POST",credentials:"omit",body:JSON.stringify(o),headers:{accept:"application/json","Content-Type":"application/json",Authorization:e}});return(await n.json()).result};async function s(e,t,o){const n=await fetch(`${window.location.origin}/api/3/action/get_signed_url`,{method:"POST",credentials:"omit",headers:{accept:"application/json","Content-Type":"application/json",Authorization:e},body:JSON.stringify({package_id:t,filename:o.name,contentType:o.type})});if(!n.ok)throw new Error("Unsuccessful request");return{method:"PUT",url:(await n.json()).result.signed_url,fields:{},headers:{"Content-Type":o.type?o.type:"application/octet-stream"}}}function c(e){let{onUploadSuccess:t,config:o}=e;const[c,u]=(0,n.useState)(!1);(0,n.useEffect)((()=>{var e;null===(e=document.getElementById("resource-link-button"))||void 0===e||e.addEventListener("click",(()=>u(!0)))}),[]);const p=n.useMemo((()=>{const e=new a.A({restrictions:{maxNumberOfFiles:1},autoProceed:!0}).use(i.A,{getUploadParameters:e=>s(o.authToken,o.datasetId,e),createMultipartUpload:async e=>{const t=e.type;return d(o.authToken,"create-multipart-upload",{...e,contentType:t,package_id:o.datasetId})},listParts:(e,t)=>d(o.authToken,"list-parts",{file:e,package_id:o.datasetId,...t}),signPart:(e,t)=>d(o.authToken,"sign-part",{file:e,package_id:o.datasetId,...t}),abortMultipartUpload:(e,t)=>d(o.authToken,"abort-multipart-upload",{file:e,package_id:o.datasetId,...t}),completeMultipartUpload:(e,t)=>d(o.authToken,"complete-multipart-upload",{...e,...t,package_id:o.datasetId})});e.on("file-added",(t=>{Object.keys(e.getState().files).length>1&&(e.removeFile(t.id),e.info("Only one file is allowed. Please remove the existing file first.","error",3e3))})),e.on("file-removed",(e=>{var t,o,n;(null!==(t=document.getElementById("resource-url-link"))&&void 0!==t?t:{checked:!1}).checked=!0,null===(o=document.getElementById("field-resource-url"))||void 0===o||o.focus(),null===(n=document.getElementById("field-resource-url"))||void 0===n||n.setAttribute("value","");for(let l of null!==(a=document.querySelectorAll(".btn.btn-danger.btn-remove-url"))&&void 0!==a?a:[]){var a;setTimeout((()=>l.click()),15)}}));for(let o of null!==(t=document.querySelectorAll(".btn.btn-danger.btn-remove-url"))&&void 0!==t?t:[]){var t;o.addEventListener("click",(()=>{e.cancelAll()}))}return e}),[]);p.on("complete",(e=>{var o,n,a;(null!==(o=document.getElementById("resource-url-upload"))&&void 0!==o?o:{checked:!1}).checked=!0,m(e.successful[0].name),(null!==(n=document.getElementById("field-name"))&&void 0!==n?n:{value:""}).value=null===(a=e.successful[0])||void 0===a?void 0:a.name,t(e)})),p.on("upload-success",((e,t)=>{p.setFileState(e.id,{progress:p.getState().files[e.id].progress,uploadURL:t.body.Location,response:t,isPaused:!1}),m(null===e||void 0===e?void 0:e.name)}));const m=e=>{const t=document.getElementById("field-resource-url");null===t||void 0===t||t.setAttribute("value",`${window.location.origin}/dataset/${o.datasetId}/resource/${o.resourceId?o.resourceId:"REPLACE_HERE"}/${e||""}`)};return(0,r.jsx)(r.Fragment,{children:c?(0,r.jsx)(r.Fragment,{}):(0,r.jsx)(l.xh,{uppy:p,showLinkToFileUploadResult:!0,hideUploadButton:!0,hideCancelButton:!0,hidePauseResumeButton:!0,hideProgressAfterFinish:!0,showRemoveButtonAfterComplete:!0})})}}}]);